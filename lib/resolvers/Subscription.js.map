{"version":3,"sources":["../../src/resolvers/Subscription.js"],"names":["FAMILY_CONNECTED","FAMILY_CHANGED","FAMILYGROUP_CHANGED","CLASSGROUP_CHANGED","WORKGROUP_CHANGED","STUDENTS_ADDED","COLLEAGUES_ADDED","MYOLDCOLLEAGUES_CHANGED","LOCATIONGROUP_CHANGED","LOCATIONGROUPUSER_ADDED","LOCATIONGROUPUSER_REMOVED","LOCATIONGROUP_REFETCH","MESSAGE_ADDED_TOPIC","GMESSAGE_ADDED_TOPIC","Subscription","familyConnected","subscribe","pubsub","asyncIterator","payload","variables","Boolean","familyIds","indexOf","id","familyChanged","ctx","console","log","user","text","familyGroupChanged","studentsAdded","classGroupChanged","colleaguesAdded","myOldcolleaguesChanged","workGroupChanged","locationGroupChanged","args","toId","messageAdded","userId","to","gMessageAdded","groupIds","from"],"mappings":"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","sourcesContent":["import { withFilter } from 'apollo-server'\r\nimport { pubsub } from '../subscriptions';\r\n\r\nexport const FAMILY_CONNECTED = 'familyConnected';\r\nexport const FAMILY_CHANGED = 'familyChanged'\r\nexport const FAMILYGROUP_CHANGED = 'familyGroupChanged'\r\nexport const CLASSGROUP_CHANGED = 'classGroupChanged'\r\nexport const WORKGROUP_CHANGED = 'workGroupChanged'\r\nexport const STUDENTS_ADDED = 'studentsAdded'\r\nexport const COLLEAGUES_ADDED = 'colleaguesAdded'\r\nexport const MYOLDCOLLEAGUES_CHANGED = 'myOldcolleaguesChanged'\r\nexport const LOCATIONGROUP_CHANGED  = 'locationGroupChanged'\r\nexport const LOCATIONGROUPUSER_ADDED = 'locationGroupUserAdded'\r\nexport const LOCATIONGROUPUSER_REMOVED = 'locationGroupUserRemoved'\r\nexport const LOCATIONGROUP_REFETCH = 'locationGroupRefech'\r\nexport const MESSAGE_ADDED_TOPIC = 'messageAdded'\r\nexport const GMESSAGE_ADDED_TOPIC = 'gMessageAdded'\r\n\r\nexport const Subscription = {\r\n  familyConnected: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(FAMILY_CONNECTED),\r\n        (payload, variables) => {\r\n          return Boolean(variables.familyIds &&\r\n            ~variables.familyIds.indexOf(payload.familyConnected.id))\r\n        }\r\n      )\r\n  },\r\n  familyChanged: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(FAMILY_CHANGED),\r\n        (payload, variables,ctx) => {\r\n          console.log('ctx.user.id',ctx.user.id)\r\n          console.log('payload.familyChanged.text',payload.familyChanged.text)\r\n          return Boolean(ctx.user.id === payload.familyChanged.text)\r\n        }\r\n    )\r\n  },\r\n  familyGroupChanged: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(FAMILYGROUP_CHANGED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.familyGroupChanged.text)\r\n        }\r\n    )\r\n  },\r\n  studentsAdded:{\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(STUDENTS_ADDED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.studentsAdded.text)\r\n        }\r\n    )\r\n  },\r\n  classGroupChanged: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(CLASSGROUP_CHANGED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.classGroupChanged.text)\r\n        }\r\n    )\r\n  },\r\n  colleaguesAdded:{\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(COLLEAGUES_ADDED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.colleaguesAdded.text)\r\n        }\r\n    )\r\n  },\r\n  myOldcolleaguesChanged:{\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(MYOLDCOLLEAGUES_CHANGED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.myOldcolleaguesChanged.text)\r\n        }\r\n    )\r\n  },\r\n  workGroupChanged: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(WORKGROUP_CHANGED),\r\n        (payload, variables,ctx) => {\r\n          return Boolean(ctx.user.id === payload.workGroupChanged.text)\r\n        }\r\n    )\r\n  },\r\n\r\n  locationGroupChanged: {\r\n    subscribe: withFilter(\r\n        () => pubsub.asyncIterator(LOCATIONGROUP_CHANGED),\r\n        (payload, args,ctx) => {\r\n          return Boolean(ctx.user.id === payload.locationGroupChanged.toId)\r\n       }\r\n    )\r\n  },\r\n \r\n  messageAdded:{\r\n    subscribe: withFilter(\r\n      () => pubsub.asyncIterator(MESSAGE_ADDED_TOPIC),\r\n      (payload, args) => {\r\n        return Boolean(args.userId === payload.messageAdded.to.id)\r\n     }\r\n  )\r\n  },\r\n\r\n  gMessageAdded:{\r\n    subscribe: withFilter(\r\n      () => pubsub.asyncIterator(GMESSAGE_ADDED_TOPIC),\r\n      (payload, args) => {\r\n        return Boolean(\r\n          args.groupIds\r\n          && ~args.groupIds.indexOf(payload.gMessageAdded.to) \r\n          &&  args.userId !== payload.gMessageAdded.from.id, // don't send to user creating message\r\n          )\r\n     }\r\n  )\r\n  }\r\n}\r\n\r\n"],"file":"Subscription.js"}