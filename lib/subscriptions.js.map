{"version":3,"sources":["../src/subscriptions.js"],"names":["pubsub","PubSub","asyncAuthIterator","messages","authPromise","asyncIterator","next","then","return","throw","error","$$asyncIterator"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAGA;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEO,IAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;;AAEPD,MAAM,CAACE,iBAAP,GAA2B,UAACC,QAAD,EAAWC,WAAX,EAA2B;AAClD,MAAMC,aAAa,GAAGL,MAAM,CAACK,aAAP,CAAqBF,QAArB,CAAtB;AACA;AACEG,IAAAA,IADF,kBACS;AACL,aAAOF,WAAW,CAACG,IAAZ,CAAiB;AAAA,eAAMF,aAAa,CAACC,IAAd,EAAN;AAAA,OAAjB,CAAP;AACD,KAHH;AAIEE,IAAAA,MAJF,qBAIW;AACP,aAAOJ,WAAW,CAACG,IAAZ,CAAiB;AAAA,eAAMF,aAAa,CAACG,MAAd,EAAN;AAAA,OAAjB,CAAP;AACD,KANH;AAOEC,IAAAA,KAPF,kBAOQC,KAPR,EAOe;AACX,aAAOL,aAAa,CAACI,KAAd,CAAoBC,KAApB,CAAP;AACD;AATH,KAUGC,wBAVH,cAUsB;AAClB,WAAON,aAAP;AACD,GAZH;AAcD,CAhBH;;eAmBeL,M","sourcesContent":["import { PubSub } from 'apollo-server';\r\nimport { RedisPubSub } from 'graphql-redis-subscriptions';\r\nimport Redis from 'ioredis';\r\n\r\n\r\nimport { $$asyncIterator } from 'iterall';\r\n\r\n// const options = {\r\n//   host: '127.0.0.1',\r\n//   port: '6379',\r\n//   retry_strategy: options  => {\r\n//     // reconnect after\r\n//     return Math.max(options.attempt * 100, 3000);\r\n//   }\r\n// };\r\n\r\n\r\n// export const pubsub = new RedisPubSub({\r\n//   connection: options,\r\n//   publisher: new Redis(options),\r\n//   subscriber: new Redis(options)\r\n// });\r\n\r\nexport const pubsub = new PubSub()\r\n\r\npubsub.asyncAuthIterator = (messages, authPromise) => {\r\n    const asyncIterator = pubsub.asyncIterator(messages);\r\n    return {\r\n      next() {\r\n        return authPromise.then(() => asyncIterator.next());\r\n      },\r\n      return() {\r\n        return authPromise.then(() => asyncIterator.return());\r\n      },\r\n      throw(error) {\r\n        return asyncIterator.throw(error);\r\n      },\r\n      [$$asyncIterator]() {\r\n        return asyncIterator;\r\n      },\r\n    };\r\n  };\r\n  \r\n\r\nexport default pubsub;"],"file":"subscriptions.js"}